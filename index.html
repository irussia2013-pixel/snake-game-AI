<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üêç –ó–º–µ–π–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 350px;
            color: white;
            font-size: 13px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .stats-section {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .score { color: #00ff88; font-weight: bold; }
        .high-score { color: #ffd700; font-weight: bold; }
        .coins { color: #ffcc00; font-weight: bold; }
        .multiplier { color: #ff66ff; font-weight: bold; font-size: 11px; }

        .god-mode-indicator {
            color: #ff0000;
            font-size: 10px;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.3; }
        }

        .header-buttons {
            display: flex;
            gap: 6px;
        }

        .header-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(145deg, #3d3d7a, #2a2a5a);
            color: white;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            transition: all 0.15s ease;
        }

        .header-btn:active { transform: scale(0.92); }
        .header-btn.paused { background: linear-gradient(145deg, #4a7a4a, #2a5a2a); }
        .shop-btn { background: linear-gradient(145deg, #7a5a3d, #5a3a2a); }
        .home-btn { background: linear-gradient(145deg, #5a3d7a, #3a2a5a); }

        #gameCanvas {
            border: 3px solid #00ff88;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        .swipe-hint {
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            cursor: pointer;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 30, 0.98);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            color: white;
            border: 2px solid #00ff88;
            z-index: 100;
            max-width: 340px;
            width: 92%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal.hidden { display: none; }
        .modal.game-over { border-color: #ff4444; }
        .modal h1, .modal h2 { margin-bottom: 12px; font-size: 22px; }
        .modal h2.red { color: #ff4444; }
        .modal p { font-size: 13px; margin-bottom: 8px; color: #aaa; }

        .final-score { font-size: 20px !important; color: #00ff88 !important; }
        .coins-earned { font-size: 15px !important; color: #ffcc00 !important; }
        .multiplier-info { font-size: 12px !important; color: #ff66ff !important; }

        .speed-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin: 12px 0;
        }

        .speed-btn {
            padding: 10px 16px;
            font-size: 13px;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .speed-btn.slow { background: linear-gradient(145deg, #2d5a2d, #1a3e1a); color: #88ff88; }
        .speed-btn.normal { background: linear-gradient(145deg, #5a5a2d, #3e3e1a); color: #ffff88; }
        .speed-btn.fast { background: linear-gradient(145deg, #5a4a2d, #3e2e1a); color: #ffaa44; }
        .speed-btn.extreme { background: linear-gradient(145deg, #5a2d2d, #3e1a1a); color: #ff6666; }
        .speed-btn:active { transform: scale(0.98); }
        .speed-btn.selected { border-color: #00ff88; box-shadow: 0 0 15px rgba(0, 255, 136, 0.4); }

        .btn-primary {
            padding: 12px 40px;
            font-size: 15px;
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 25px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 8px;
        }

        .btn-primary:active { transform: scale(0.95); }

        .btn-secondary {
            padding: 10px 25px;
            font-size: 13px;
            background: linear-gradient(145deg, #ffd700, #ffaa00);
            border: none;
            border-radius: 20px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            margin-top: 8px;
        }

        .btn-secondary:active { transform: scale(0.95); }

        .btn-menu {
            padding: 10px 25px;
            font-size: 13px;
            background: linear-gradient(145deg, #888899, #555566);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 8px;
        }

        .btn-menu:active { transform: scale(0.95); }

        .btn-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .pause-overlay { border-color: #ffd700; }
        .pause-overlay h2 { color: #ffd700; }

        .shop-modal { border-color: #ffcc00; }
        .shop-modal h2 { color: #ffcc00; }

        .shop-coins {
            background: rgba(255, 204, 0, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .shop-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .shop-tab {
            flex: 1;
            min-width: 60px;
            padding: 8px 4px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #aaa;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shop-tab.active {
            background: rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .shop-item {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .shop-item:active { transform: scale(0.96); }
        .shop-item.selected { border-color: #00ff88; background: rgba(0, 255, 136, 0.15); }
        .shop-item.locked { opacity: 0.6; }
        .shop-item.locked:not(.affordable) { opacity: 0.4; }
        .shop-item.affordable { border-color: #ffcc00; }

        .item-preview {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .item-name { font-size: 10px; color: white; text-align: center; }
        .item-price { font-size: 11px; color: #ffcc00; }
        .item-owned { font-size: 10px; color: #00ff88; }
        .item-bonus { font-size: 9px; color: #ff66ff; }

        .multiplier-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .multiplier-item {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .multiplier-item:active { transform: scale(0.98); }
        .multiplier-item.affordable { border-color: #ffcc00; }
        .multiplier-item.owned { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
        .multiplier-item.maxed { opacity: 0.5; }

        .mult-info { text-align: left; }
        .mult-name { font-size: 14px; color: white; font-weight: bold; }
        .mult-desc { font-size: 11px; color: #aaa; }
        .mult-bonus { font-size: 12px; color: #ff66ff; }

        .mult-action { text-align: right; }
        .mult-price { font-size: 13px; color: #ffcc00; font-weight: bold; }
        .mult-status { font-size: 11px; color: #00ff88; }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 22px;
            cursor: pointer;
        }

        .new-record {
            color: #ffd700;
            font-size: 16px;
            animation: pulse 0.5s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .difficulty-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 10px;
            margin: 6px 0;
        }

        .difficulty-badge.slow { background: #2d5a2d; color: #88ff88; }
        .difficulty-badge.normal { background: #5a5a2d; color: #ffff88; }
        .difficulty-badge.fast { background: #5a4a2d; color: #ffaa44; }
        .difficulty-badge.extreme { background: #5a2d2d; color: #ff6666; }

        .snake-green { background: linear-gradient(135deg, #00ff88, #00aa55); }
        .snake-blue { background: linear-gradient(135deg, #00aaff, #0066cc); }
        .snake-purple { background: linear-gradient(135deg, #aa66ff, #6622cc); }
        .snake-gold { background: linear-gradient(135deg, #ffd700, #ff9500); }
        .snake-fire { background: linear-gradient(135deg, #ff4444, #ff8800); }
        .snake-rainbow { background: linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff00, #00ffff, #0088ff, #8800ff); }
        .snake-ice { background: linear-gradient(135deg, #88ffff, #0088ff); }
        .snake-pink { background: linear-gradient(135deg, #ff66aa, #ff0088); }

        .bg-default { background: linear-gradient(135deg, #0a0a1a, #1a1a3a); }
        .bg-forest { background: linear-gradient(135deg, #0a2a0a, #1a4a1a); }
        .bg-ocean { background: linear-gradient(135deg, #0a1a2a, #1a3a5a); }
        .bg-lava { background: linear-gradient(135deg, #2a0a0a, #4a1a0a); }
        .bg-space { background: linear-gradient(135deg, #0a0a2a, #1a0a3a); }
        .bg-neon { background: linear-gradient(135deg, #1a0a2a, #2a1a4a); }
        .bg-sunset { background: linear-gradient(135deg, #2a1a0a, #4a2a1a); }
        .bg-matrix { background: linear-gradient(135deg, #001a00, #003a00); }

        .food-apple { background: radial-gradient(circle, #ff4444, #cc0000); }
        .food-cherry { background: radial-gradient(circle, #ff2266, #aa0033); }
        .food-orange { background: radial-gradient(circle, #ffaa00, #cc7700); }
        .food-lemon { background: radial-gradient(circle, #ffff44, #cccc00); }
        .food-grape { background: radial-gradient(circle, #aa44ff, #6600aa); }
        .food-watermelon { background: linear-gradient(135deg, #44ff44, #ff4466); }
        .food-star { background: radial-gradient(circle, #ffdd00, #ffaa00); }
        .food-diamond { background: radial-gradient(circle, #44ffff, #0088ff); }
        .food-heart { background: radial-gradient(circle, #ff4488, #cc0044); }
        .food-pizza { background: radial-gradient(circle, #ffcc66, #cc8833); }
        .food-donut { background: radial-gradient(circle, #ff88cc, #cc5599); }
        .food-coin { background: radial-gradient(circle, #ffd700, #aa8800); }

        .current-mult-badge {
            background: rgba(255, 102, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #ff66ff;
            margin-bottom: 10px;
        }

        .total-mult {
            font-size: 11px;
            color: #aaa;
            margin-top: 5px;
        }

        .admin-modal { border-color: #ff0000 !important; max-width: 360px; }
        .admin-modal h2 { color: #ff0000; }

        .admin-warning {
            background: rgba(255, 0, 0, 0.2);
            padding: 8px;
            border-radius: 10px;
            font-size: 11px;
            color: #ff6666;
            margin-bottom: 15px;
        }

        .admin-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            text-align: left;
        }

        .admin-section-title {
            font-size: 14px;
            color: #ff6666;
            margin-bottom: 10px;
        }

        .admin-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .admin-row:last-child { margin-bottom: 0; }

        .admin-label {
            flex: 1;
            font-size: 12px;
            color: #ccc;
        }

        .admin-input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #444;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 13px;
            text-align: center;
        }

        .admin-input:focus {
            outline: none;
            border-color: #ff6666;
        }

        .admin-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-btn:active { transform: scale(0.95); }
        .admin-btn.green { background: linear-gradient(145deg, #00aa66, #008844); color: white; }
        .admin-btn.blue { background: linear-gradient(145deg, #4488ff, #2266cc); color: white; }
        .admin-btn.orange { background: linear-gradient(145deg, #ffaa00, #cc8800); color: #1a1a2e; }
        .admin-btn.red { background: linear-gradient(145deg, #ff4444, #cc2222); color: white; }
        .admin-btn.purple { background: linear-gradient(145deg, #aa66ff, #8844cc); color: white; }
        .admin-btn.full { width: 100%; padding: 10px; }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #333;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active { background: #00ff88; }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s;
        }

        .toggle-switch.active::after { left: 27px; }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .admin-stat-box {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }

        .admin-stat-value { font-size: 18px; font-weight: bold; color: #00ff88; }
        .admin-stat-label { font-size: 10px; color: #888; }

        .admin-quick-coins {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .admin-quick-coins .admin-btn {
            flex: 1;
            min-width: 60px;
        }

        /* –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ */
        .confirm-modal {
            border-color: #ffaa00 !important;
        }

        .confirm-modal h2 {
            color: #ffaa00;
        }

        .confirm-text {
            font-size: 14px !important;
            color: #ccc !important;
            margin: 15px 0 !important;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div class="stats-section">
                <div class="stat"><span id="foodEmoji">üçé</span> <span class="score" id="score">0</span></div>
                <div class="stat">üèÜ <span class="high-score" id="highScore">0</span></div>
                <div class="stat">üí∞ <span class="coins" id="coins">0</span></div>
                <div class="stat multiplier" id="multDisplay">√ó1</div>
                <div class="stat god-mode-indicator hidden" id="godModeIndicator">üëë</div>
            </div>
            <div class="header-buttons">
                <button class="header-btn home-btn" id="homeBtn" title="–í –º–µ–Ω—é">üè†</button>
                <button class="header-btn shop-btn" id="shopBtn" title="–ú–∞–≥–∞–∑–∏–Ω">üõí</button>
                <button class="header-btn" id="pauseBtn" title="–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
            </div>
        </div>
        
        <canvas id="gameCanvas"></canvas>
        <p class="swipe-hint" id="secretTrigger">üëÜ –°–≤–∞–π–ø–∞–π—Ç–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
    </div>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="modal" id="startScreen">
        <h1>üêç –ó–º–µ–π–∫–∞</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å</p>
        
        <div class="speed-options">
            <button class="speed-btn slow" data-speed="200" data-name="–õ–µ–≥–∫–æ" data-mult="1">
                <span>üê¢ –õ–µ–≥–∫–æ</span><span>√ó1</span>
            </button>
            <button class="speed-btn normal selected" data-speed="140" data-name="–ù–æ—Ä–º–∞–ª—å–Ω–æ" data-mult="2">
                <span>üêá –ù–æ—Ä–º–∞–ª—å–Ω–æ</span><span>√ó2</span>
            </button>
            <button class="speed-btn fast" data-speed="90" data-name="–ë—ã—Å—Ç—Ä–æ" data-mult="3">
                <span>ü¶ä –ë—ã—Å—Ç—Ä–æ</span><span>√ó3</span>
            </button>
            <button class="speed-btn extreme" data-speed="50" data-name="–≠–∫—Å—Ç—Ä–∏–º" data-mult="5">
                <span>üöÄ –≠–∫—Å—Ç—Ä–∏–º</span><span>√ó5</span>
            </button>
        </div>

        <p class="total-mult" id="startTotalMult">–ò—Ç–æ–≥–æ: √ó2</p>
        
        <button class="btn-primary" id="startBtn">‚ñ∂Ô∏è –ò–≥—Ä–∞—Ç—å</button>
    </div>

    <!-- –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã -->
    <div class="modal game-over hidden" id="gameOver">
        <h2 class="red">üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <p class="final-score">–°—á—ë—Ç: <span id="finalScore">0</span></p>
        <p class="coins-earned">+<span id="coinsEarned">0</span> üí∞</p>
        <p class="multiplier-info" id="multBreakdown"></p>
        <p id="newRecord" class="new-record" style="display: none;">üéâ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥! üéâ</p>
        <div id="difficultyBadge" class="difficulty-badge normal">–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
        
        <div class="btn-row">
            <button class="btn-menu" id="menuFromGameOver">üè† –ú–µ–Ω—é</button>
            <button class="btn-primary" id="restartBtn">üîÑ –ó–∞–Ω–æ–≤–æ</button>
        </div>
    </div>

    <!-- –ü–∞—É–∑–∞ -->
    <div class="modal pause-overlay hidden" id="pauseOverlay">
        <h2>‚è∏Ô∏è –ü–∞—É–∑–∞</h2>
        <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
        <p style="font-size: 12px; color: #888; margin-top: 5px;">
            –°—á—ë—Ç: <span id="pauseScore">0</span> | 
            –ú–æ–Ω–µ—Ç—ã: +<span id="pauseCoins">0</span>
        </p>
        
        <div class="btn-row">
            <button class="btn-menu" id="menuFromPause">üè† –ú–µ–Ω—é</button>
            <button class="btn-secondary" id="resumeBtn">‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ -->
    <div class="modal confirm-modal hidden" id="confirmModal">
        <h2>‚ö†Ô∏è –í—ã–π—Ç–∏ –≤ –º–µ–Ω—é?</h2>
        <p class="confirm-text">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.<br>–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ <span id="confirmCoins">0</span> üí∞</p>
        
        <div class="btn-row">
            <button class="btn-menu" id="cancelExit">‚ùå –û—Ç–º–µ–Ω–∞</button>
            <button class="btn-secondary" id="confirmExit">‚úì –í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div class="modal shop-modal hidden" id="shopModal">
        <button class="close-btn" id="closeShop">‚úï</button>
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
        <div class="shop-coins">üí∞ <span id="shopCoins">0</span></div>
        <div class="current-mult-badge">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="currentMultBadge">√ó1</span></div>
        
        <div class="shop-tabs">
            <button class="shop-tab active" data-tab="multipliers">üíé –ú–Ω–æ–∂.</button>
            <button class="shop-tab" data-tab="foods">üçé –ï–¥–∞</button>
            <button class="shop-tab" data-tab="skins">üêç –ó–º–µ–π–∫–∏</button>
            <button class="shop-tab" data-tab="backgrounds">üé® –§–æ–Ω—ã</button>
        </div>
        
        <div id="shopContent"></div>
        
        <button class="btn-secondary" id="closeShopBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
    <div class="modal admin-modal hidden" id="adminModal">
        <button class="close-btn" id="closeAdmin">‚úï</button>
        <h2>üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <div class="admin-warning">‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–∏—Ç–æ–≤ –º–æ–∂–µ—Ç –∏—Å–ø–æ—Ä—Ç–∏—Ç—å –∏–≥—Ä–æ–≤–æ–π –æ–ø—ã—Ç!</div>

        <div class="admin-stats">
            <div class="admin-stat-box">
                <div class="admin-stat-value" id="adminCoins">0</div>
                <div class="admin-stat-label">–ú–æ–Ω–µ—Ç—ã</div>
            </div>
            <div class="admin-stat-box">
                <div class="admin-stat-value" id="adminHighScore">0</div>
                <div class="admin-stat-label">–†–µ–∫–æ—Ä–¥</div>
            </div>
        </div>

        <div class="admin-section">
            <div class="admin-section-title">üí∞ –ú–æ–Ω–µ—Ç—ã</div>
            <div class="admin-quick-coins">
                <button class="admin-btn green" onclick="adminAddCoins(100)">+100</button>
                <button class="admin-btn green" onclick="adminAddCoins(500)">+500</button>
                <button class="admin-btn green" onclick="adminAddCoins(1000)">+1K</button>
                <button class="admin-btn green" onclick="adminAddCoins(10000)">+10K</button>
            </div>
            <div class="admin-row" style="margin-top: 10px;">
                <input type="number" class="admin-input" id="customCoins" placeholder="–ö–æ–ª-–≤–æ">
                <button class="admin-btn blue" onclick="adminAddCoins(parseInt(document.getElementById('customCoins').value) || 0)">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="admin-btn orange" onclick="adminSetCoins(parseInt(document.getElementById('customCoins').value) || 0)">–£—Å—Ç.</button>
            </div>
        </div>

        <div class="admin-section">
            <div class="admin-section-title">üéÆ –ò–≥—Ä–æ–≤—ã–µ —á–∏—Ç—ã</div>
            <div class="admin-row">
                <span class="admin-label">üëë –ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ</span>
                <div class="toggle-switch" id="godModeToggle" onclick="toggleGodMode()"></div>
            </div>
            <div class="admin-row">
                <span class="admin-label">üêå –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ</span>
                <div class="toggle-switch" id="slowModeToggle" onclick="toggleSlowMode()"></div>
            </div>
            <div class="admin-row">
                <span class="admin-label">‚ö° –°—É–ø–µ—Ä —Å–∫–æ—Ä–æ—Å—Ç—å</span>
                <div class="toggle-switch" id="fastModeToggle" onclick="toggleFastMode()"></div>
            </div>
        </div>

        <div class="admin-section">
            <div class="admin-section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
            <button class="admin-btn purple full" onclick="adminGrowSnake()">üêç –í—ã—Ä–∞—Å—Ç–∏—Ç—å –∑–º–µ–π–∫—É (+5)</button>
            <button class="admin-btn blue full" style="margin-top:6px" onclick="adminTeleportFood()">üçé –¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–¥—É</button>
            <button class="admin-btn orange full" style="margin-top:6px" onclick="adminAddScore(100)">üéØ +100 –æ—á–∫–æ–≤</button>
        </div>

        <div class="admin-section">
            <div class="admin-section-title">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞</div>
            <button class="admin-btn purple full" onclick="adminUnlockAll()">üåü –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –í–°–Å + 50K</button>
        </div>

        <div class="admin-section">
            <div class="admin-section-title">üóëÔ∏è –°–±—Ä–æ—Å</div>
            <button class="admin-btn red full" onclick="adminResetProgress()">‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
        </div>

        <button class="btn-secondary" id="closeAdminBtn" style="margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        // ===== –î–ê–ù–ù–´–ï –ú–ê–ì–ê–ó–ò–ù–ê =====
        const MULTIPLIERS = [
            { id: 'mult1', name: '–°—Ç–∞—Ä—Ç–æ–≤—ã–π', value: 1, price: 0, desc: '–ë–∞–∑–æ–≤—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å' },
            { id: 'mult2', name: '–ë—Ä–æ–Ω–∑–æ–≤—ã–π', value: 1.5, price: 100, desc: '+50% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult3', name: '–°–µ—Ä–µ–±—Ä—è–Ω—ã–π', value: 2, price: 300, desc: '+100% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult4', name: '–ó–æ–ª–æ—Ç–æ–π', value: 3, price: 600, desc: '+200% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult5', name: '–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π', value: 5, price: 1200, desc: '+400% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult6', name: '–ê–ª–º–∞–∑–Ω—ã–π', value: 8, price: 2500, desc: '+700% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult7', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', value: 12, price: 5000, desc: '+1100% –∫ –º–æ–Ω–µ—Ç–∞–º' },
            { id: 'mult8', name: '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π', value: 20, price: 10000, desc: '+1900% –∫ –º–æ–Ω–µ—Ç–∞–º' }
        ];

        const FOODS = [
            { id: 'apple', name: '–Ø–±–ª–æ–∫–æ', emoji: 'üçé', price: 0, color: '#ff4444', bonus: 0, class: 'food-apple' },
            { id: 'cherry', name: '–í–∏—à–Ω—è', emoji: 'üçí', price: 30, color: '#ff2266', bonus: 0, class: 'food-cherry' },
            { id: 'orange', name: '–ê–ø–µ–ª—å—Å–∏–Ω', emoji: 'üçä', price: 50, color: '#ffaa00', bonus: 0, class: 'food-orange' },
            { id: 'lemon', name: '–õ–∏–º–æ–Ω', emoji: 'üçã', price: 50, color: '#ffff44', bonus: 0, class: 'food-lemon' },
            { id: 'grape', name: '–í–∏–Ω–æ–≥—Ä–∞–¥', emoji: 'üçá', price: 75, color: '#aa44ff', bonus: 1, class: 'food-grape' },
            { id: 'watermelon', name: '–ê—Ä–±—É–∑', emoji: 'üçâ', price: 100, color: '#44ff44', bonus: 1, class: 'food-watermelon' },
            { id: 'pizza', name: '–ü–∏—Ü—Ü–∞', emoji: 'üçï', price: 150, color: '#ffcc66', bonus: 2, class: 'food-pizza' },
            { id: 'donut', name: '–ü–æ–Ω—á–∏–∫', emoji: 'üç©', price: 150, color: '#ff88cc', bonus: 2, class: 'food-donut' },
            { id: 'star', name: '–ó–≤–µ–∑–¥–∞', emoji: '‚≠ê', price: 250, color: '#ffdd00', bonus: 3, class: 'food-star' },
            { id: 'heart', name: '–°–µ—Ä–¥—Ü–µ', emoji: '‚ù§Ô∏è', price: 300, color: '#ff4488', bonus: 3, class: 'food-heart' },
            { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 500, color: '#44ffff', bonus: 5, class: 'food-diamond' },
            { id: 'coin', name: '–ú–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', price: 1000, color: '#ffd700', bonus: 10, class: 'food-coin' }
        ];

        const SKINS = [
            { id: 'green', name: '–ó–µ–ª—ë–Ω—ã–π', price: 0, colors: ['#00ff88', '#00aa55'], class: 'snake-green' },
            { id: 'blue', name: '–°–∏–Ω–∏–π', price: 50, colors: ['#00aaff', '#0066cc'], class: 'snake-blue' },
            { id: 'purple', name: '–§–∏–æ–ª–µ—Ç', price: 75, colors: ['#aa66ff', '#6622cc'], class: 'snake-purple' },
            { id: 'pink', name: '–†–æ–∑–æ–≤—ã–π', price: 75, colors: ['#ff66aa', '#ff0088'], class: 'snake-pink' },
            { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', price: 100, colors: ['#ffd700', '#ff9500'], class: 'snake-gold' },
            { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω—ã–π', price: 150, colors: ['#ff4444', '#ff8800'], class: 'snake-fire' },
            { id: 'ice', name: '–õ–µ–¥—è–Ω–æ–π', price: 150, colors: ['#88ffff', '#0088ff'], class: 'snake-ice' },
            { id: 'rainbow', name: '–†–∞–¥—É–≥–∞', price: 300, colors: ['rainbow'], class: 'snake-rainbow' }
        ];

        const BACKGROUNDS = [
            { id: 'default', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', price: 0, colors: ['#0a0a1a', '#1a1a3a'], border: '#00ff88', class: 'bg-default' },
            { id: 'forest', name: '–õ–µ—Å', price: 50, colors: ['#0a2a0a', '#1a4a1a'], border: '#44ff44', class: 'bg-forest' },
            { id: 'ocean', name: '–û–∫–µ–∞–Ω', price: 75, colors: ['#0a1a2a', '#1a3a5a'], border: '#44aaff', class: 'bg-ocean' },
            { id: 'lava', name: '–õ–∞–≤–∞', price: 100, colors: ['#2a0a0a', '#4a1a0a'], border: '#ff6644', class: 'bg-lava' },
            { id: 'space', name: '–ö–æ—Å–º–æ—Å', price: 100, colors: ['#0a0a2a', '#1a0a3a'], border: '#aa66ff', class: 'bg-space' },
            { id: 'sunset', name: '–ó–∞–∫–∞—Ç', price: 125, colors: ['#2a1a0a', '#4a2a1a'], border: '#ffaa44', class: 'bg-sunset' },
            { id: 'matrix', name: '–ú–∞—Ç—Ä–∏—Ü–∞', price: 150, colors: ['#001a00', '#003a00'], border: '#00ff00', class: 'bg-matrix' },
            { id: 'neon', name: '–ù–µ–æ–Ω', price: 200, colors: ['#1a0a2a', '#2a1a4a'], border: '#ff00ff', class: 'bg-neon' }
        ];

        // ===== –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const size = Math.min(window.innerWidth - 40, 350);
        canvas.width = size;
        canvas.height = size;
        
        const gridSize = 20;
        const tileCount = Math.floor(size / gridSize);
        
        let snake = [];
        let food = {};
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        let score = 0;
        let coinsThisGame = 0;
        let applesThisGame = 0;
        let gameLoop = null;
        let baseSpeed = 140;
        let gameSpeed = 140;
        let originalSpeed = 140;
        let difficultyMult = 2;
        let isRunning = false;
        let isPaused = false;
        let selectedDifficulty = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
        let selectedSpeedClass = 'normal';
        let currentShopTab = 'multipliers';

        let godMode = false;
        let slowMode = false;
        let fastMode = false;

        let secretTapCount = 0;
        let secretTapTimer = null;

        // ===== –°–û–•–†–ê–ù–Å–ù–ù–´–ï –î–ê–ù–ù–´–ï =====
        let playerData = loadPlayerData();

        function loadPlayerData() {
            const saved = localStorage.getItem('snakePlayerData5');
            if (saved) return JSON.parse(saved);
            return {
                coins: 0,
                highScore: 0,
                ownedSkins: ['green'],
                ownedBackgrounds: ['default'],
                ownedFoods: ['apple'],
                ownedMultipliers: ['mult1'],
                selectedSkin: 'green',
                selectedBackground: 'default',
                selectedFood: 'apple',
                selectedMultiplier: 'mult1'
            };
        }

        function savePlayerData() {
            localStorage.setItem('snakePlayerData5', JSON.stringify(playerData));
        }

        function getPlayerMultiplier() {
            const mult = MULTIPLIERS.find(m => m.id === playerData.selectedMultiplier);
            return mult ? mult.value : 1;
        }

        function getFoodBonus() {
            const food = FOODS.find(f => f.id === playerData.selectedFood);
            return food ? food.bonus : 0;
        }

        function getTotalMultiplier() {
            return difficultyMult * getPlayerMultiplier();
        }

        function getSelectedFood() {
            return FOODS.find(f => f.id === playerData.selectedFood) || FOODS[0];
        }

        // ===== DOM –≠–õ–ï–ú–ï–ù–¢–´ =====
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');
        const coinsEl = document.getElementById('coins');
        const multDisplayEl = document.getElementById('multDisplay');
        const foodEmojiEl = document.getElementById('foodEmoji');
        const godModeIndicatorEl = document.getElementById('godModeIndicator');
        const gameOverEl = document.getElementById('gameOver');
        const finalScoreEl = document.getElementById('finalScore');
        const coinsEarnedEl = document.getElementById('coinsEarned');
        const multBreakdownEl = document.getElementById('multBreakdown');
        const startScreenEl = document.getElementById('startScreen');
        const startTotalMultEl = document.getElementById('startTotalMult');
        const pauseOverlayEl = document.getElementById('pauseOverlay');
        const pauseBtnEl = document.getElementById('pauseBtn');
        const newRecordEl = document.getElementById('newRecord');
        const difficultyBadgeEl = document.getElementById('difficultyBadge');
        const shopModal = document.getElementById('shopModal');
        const shopCoinsEl = document.getElementById('shopCoins');
        const shopContentEl = document.getElementById('shopContent');
        const currentMultBadgeEl = document.getElementById('currentMultBadge');
        const adminModal = document.getElementById('adminModal');
        const confirmModal = document.getElementById('confirmModal');
        const speedBtns = document.querySelectorAll('.speed-btn');
        const shopTabs = document.querySelectorAll('.shop-tab');

        function updateUI() {
            highScoreEl.textContent = playerData.highScore;
            coinsEl.textContent = playerData.coins;
            foodEmojiEl.textContent = getSelectedFood().emoji;
            updateMultDisplay();
        }

        function updateMultDisplay() {
            const total = getTotalMultiplier();
            const foodBonus = getFoodBonus();
            let text = `√ó${total}`;
            if (foodBonus > 0) text += `+${foodBonus}`;
            multDisplayEl.textContent = text;
            startTotalMultEl.textContent = `√ó${total} –º–Ω–æ–∂. + ${foodBonus} –±–æ–Ω—É—Å`;
        }

        updateUI();

        // ===== –§–£–ù–ö–¶–ò–Ø –í–´–•–û–î–ê –í –ú–ï–ù–Æ =====
        function showExitConfirm() {
            if (!isRunning) {
                goToMenu();
                return;
            }
            
            if (!isPaused) togglePause();
            
            document.getElementById('confirmCoins').textContent = coinsThisGame;
            confirmModal.classList.remove('hidden');
            pauseOverlayEl.classList.add('hidden');
        }

        function goToMenu() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
            if (isRunning && coinsThisGame > 0) {
                playerData.coins += coinsThisGame;
                
                if (score > playerData.highScore) {
                    playerData.highScore = score;
                    highScoreEl.textContent = playerData.highScore;
                }
                
                savePlayerData();
                coinsEl.textContent = playerData.coins;
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
            isRunning = false;
            isPaused = false;
            clearInterval(gameLoop);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª–∫–∏
            confirmModal.classList.add('hidden');
            pauseOverlayEl.classList.add('hidden');
            gameOverEl.classList.add('hidden');
            shopModal.classList.add('hidden');
            adminModal.classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
            startScreenEl.classList.remove('hidden');
            
            updatePauseButton();
            updateUI();
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø–æ–ª–µ
            initGame();
            draw();
        }

        function cancelExit() {
            confirmModal.classList.add('hidden');
            pauseOverlayEl.classList.remove('hidden');
        }

        // ===== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ =====
        function openAdmin() {
            document.getElementById('adminCoins').textContent = playerData.coins;
            document.getElementById('adminHighScore').textContent = playerData.highScore;
            updateAdminToggles();
            adminModal.classList.remove('hidden');
            if (isRunning && !isPaused) togglePause();
        }

        function closeAdmin() {
            adminModal.classList.add('hidden');
        }

        function updateAdminToggles() {
            document.getElementById('godModeToggle').classList.toggle('active', godMode);
            document.getElementById('slowModeToggle').classList.toggle('active', slowMode);
            document.getElementById('fastModeToggle').classList.toggle('active', fastMode);
        }

        function adminAddCoins(amount) {
            playerData.coins += amount;
            savePlayerData();
            updateUI();
            document.getElementById('adminCoins').textContent = playerData.coins;
            shopCoinsEl.textContent = playerData.coins;
            vibrate(50);
        }

        function adminSetCoins(amount) {
            playerData.coins = Math.max(0, amount);
            savePlayerData();
            updateUI();
            document.getElementById('adminCoins').textContent = playerData.coins;
            shopCoinsEl.textContent = playerData.coins;
            vibrate(50);
        }

        function toggleGodMode() {
            godMode = !godMode;
            godModeIndicatorEl.classList.toggle('hidden', !godMode);
            updateAdminToggles();
            vibrate(godMode ? 100 : 30);
        }

        function toggleSlowMode() {
            slowMode = !slowMode;
            if (slowMode) fastMode = false;
            updateGameSpeed();
            updateAdminToggles();
            vibrate(30);
        }

        function toggleFastMode() {
            fastMode = !fastMode;
            if (fastMode) slowMode = false;
            updateGameSpeed();
            updateAdminToggles();
            vibrate(30);
        }

        function updateGameSpeed() {
            if (!isRunning) return;
            let newSpeed = originalSpeed;
            if (slowMode) newSpeed = originalSpeed * 3;
            if (fastMode) newSpeed = Math.max(30, originalSpeed / 2);
            gameSpeed = newSpeed;
            clearInterval(gameLoop);
            gameLoop = setInterval(update, gameSpeed);
        }

        function adminGrowSnake() {
            if (!isRunning) return;
            for (let i = 0; i < 5; i++) {
                const tail = snake[snake.length - 1];
                snake.push({ ...tail });
            }
            score += 50;
            scoreEl.textContent = score;
            draw();
            vibrate(50);
        }

        function adminTeleportFood() {
            if (!isRunning) return;
            const head = snake[0];
            food = { x: head.x + direction.x, y: head.y + direction.y };
            if (food.x < 0) food.x = 0;
            if (food.x >= tileCount) food.x = tileCount - 1;
            if (food.y < 0) food.y = 0;
            if (food.y >= tileCount) food.y = tileCount - 1;
            draw();
            vibrate(50);
        }

        function adminAddScore(amount) {
            score += amount;
            scoreEl.textContent = score;
            vibrate(50);
        }

        function adminUnlockAll() {
            SKINS.forEach(s => { if (!playerData.ownedSkins.includes(s.id)) playerData.ownedSkins.push(s.id); });
            BACKGROUNDS.forEach(b => { if (!playerData.ownedBackgrounds.includes(b.id)) playerData.ownedBackgrounds.push(b.id); });
            FOODS.forEach(f => { if (!playerData.ownedFoods.includes(f.id)) playerData.ownedFoods.push(f.id); });
            MULTIPLIERS.forEach(m => { if (!playerData.ownedMultipliers.includes(m.id)) playerData.ownedMultipliers.push(m.id); });
            playerData.selectedMultiplier = 'mult8';
            playerData.coins += 50000;
            savePlayerData();
            updateUI();
            document.getElementById('adminCoins').textContent = playerData.coins;
            vibrate(100);
            alert('–í—Å—ë —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ + 50,000 –º–æ–Ω–µ—Ç!');
        }

        function adminResetProgress() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω!')) {
                localStorage.removeItem('snakePlayerData5');
                playerData = loadPlayerData();
                godMode = false;
                slowMode = false;
                fastMode = false;
                updateUI();
                updateAdminToggles();
                godModeIndicatorEl.classList.add('hidden');
                document.getElementById('adminCoins').textContent = playerData.coins;
                document.getElementById('adminHighScore').textContent = playerData.highScore;
                vibrate([100, 50, 100]);
                alert('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω!');
            }
        }

        document.getElementById('secretTrigger').addEventListener('click', () => {
            secretTapCount++;
            clearTimeout(secretTapTimer);
            if (secretTapCount >= 5) {
                secretTapCount = 0;
                openAdmin();
            } else {
                secretTapTimer = setTimeout(() => secretTapCount = 0, 2000);
            }
        });

        window.openAdmin = openAdmin;
        document.getElementById('closeAdmin').addEventListener('click', closeAdmin);
        document.getElementById('closeAdminBtn').addEventListener('click', closeAdmin);

        // ===== –ú–ê–ì–ê–ó–ò–ù =====
        function openShop() {
            if (isRunning && !isPaused) togglePause();
            shopCoinsEl.textContent = playerData.coins;
            currentMultBadgeEl.textContent = `√ó${getPlayerMultiplier()} +${getFoodBonus()}`;
            renderShopContent();
            shopModal.classList.remove('hidden');
        }

        function closeShop() {
            shopModal.classList.add('hidden');
            updateMultDisplay();
            updateUI();
            draw();
        }

        function renderShopContent() {
            switch(currentShopTab) {
                case 'multipliers': renderMultipliers(); break;
                case 'foods': renderFoods(); break;
                case 'skins': renderItems('skins'); break;
                case 'backgrounds': renderItems('backgrounds'); break;
            }
        }

        function renderMultipliers() {
            shopContentEl.innerHTML = `
                <div class="multiplier-section">
                    ${MULTIPLIERS.map((mult, index) => {
                        const isOwned = playerData.ownedMultipliers.includes(mult.id);
                        const isSelected = playerData.selectedMultiplier === mult.id;
                        const canAfford = playerData.coins >= mult.price;
                        const prevOwned = index === 0 || playerData.ownedMultipliers.includes(MULTIPLIERS[index - 1].id);
                        const canBuy = !isOwned && canAfford && prevOwned;
                        
                        let statusClass = isSelected ? 'owned' : isOwned ? 'owned' : canBuy ? 'affordable' : 'maxed';

                        return `
                            <div class="multiplier-item ${statusClass}" data-id="${mult.id}">
                                <div class="mult-info">
                                    <div class="mult-name">${mult.name}</div>
                                    <div class="mult-desc">${mult.desc}</div>
                                    <div class="mult-bonus">√ó${mult.value}</div>
                                </div>
                                <div class="mult-action">
                                    ${isOwned 
                                        ? `<div class="mult-status">${isSelected ? '‚úì –ê–∫—Ç–∏–≤–µ–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</div>`
                                        : prevOwned 
                                            ? `<div class="mult-price">üí∞ ${mult.price}</div>`
                                            : `<div class="mult-status" style="color:#666">üîí</div>`
                                    }
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            document.querySelectorAll('.multiplier-item').forEach(el => {
                el.addEventListener('click', () => handleMultiplierClick(el.dataset.id));
            });
        }

        function handleMultiplierClick(id) {
            const index = MULTIPLIERS.findIndex(m => m.id === id);
            const mult = MULTIPLIERS[index];
            const isOwned = playerData.ownedMultipliers.includes(id);
            const prevOwned = index === 0 || playerData.ownedMultipliers.includes(MULTIPLIERS[index - 1].id);

            if (isOwned) {
                playerData.selectedMultiplier = id;
                savePlayerData();
                currentMultBadgeEl.textContent = `√ó${getPlayerMultiplier()} +${getFoodBonus()}`;
                renderMultipliers();
                vibrate(30);
            } else if (playerData.coins >= mult.price && prevOwned) {
                playerData.coins -= mult.price;
                playerData.ownedMultipliers.push(id);
                playerData.selectedMultiplier = id;
                savePlayerData();
                coinsEl.textContent = playerData.coins;
                shopCoinsEl.textContent = playerData.coins;
                currentMultBadgeEl.textContent = `√ó${getPlayerMultiplier()} +${getFoodBonus()}`;
                renderMultipliers();
                vibrate(100);
            }
        }

        function renderFoods() {
            shopContentEl.innerHTML = `
                <div class="shop-items">
                    ${FOODS.map(food => {
                        const isOwned = playerData.ownedFoods.includes(food.id);
                        const isSelected = playerData.selectedFood === food.id;
                        const canAfford = playerData.coins >= food.price;
                        
                        let statusClass = isSelected ? 'selected' : !isOwned && canAfford ? 'locked affordable' : !isOwned ? 'locked' : '';

                        return `
                            <div class="shop-item ${statusClass}" data-id="${food.id}" data-type="foods">
                                <div class="item-preview ${food.class}">${food.emoji}</div>
                                <div class="item-name">${food.name}</div>
                                ${food.bonus > 0 ? `<div class="item-bonus">+${food.bonus} üí∞</div>` : ''}
                                ${isOwned 
                                    ? `<div class="item-owned">${isSelected ? '‚úì –í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å'}</div>`
                                    : `<div class="item-price">üí∞ ${food.price}</div>`
                                }
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            document.querySelectorAll('.shop-item[data-type="foods"]').forEach(el => {
                el.addEventListener('click', () => handleFoodClick(el.dataset.id));
            });
        }

        function handleFoodClick(id) {
            const food = FOODS.find(f => f.id === id);
            const isOwned = playerData.ownedFoods.includes(id);

            if (isOwned) {
                playerData.selectedFood = id;
                savePlayerData();
                updateUI();
                currentMultBadgeEl.textContent = `√ó${getPlayerMultiplier()} +${getFoodBonus()}`;
                renderFoods();
                vibrate(30);
            } else if (playerData.coins >= food.price) {
                playerData.coins -= food.price;
                playerData.ownedFoods.push(id);
                playerData.selectedFood = id;
                savePlayerData();
                coinsEl.textContent = playerData.coins;
                shopCoinsEl.textContent = playerData.coins;
                updateUI();
                currentMultBadgeEl.textContent = `√ó${getPlayerMultiplier()} +${getFoodBonus()}`;
                renderFoods();
                vibrate(100);
            }
        }

        function renderItems(type) {
            const items = type === 'skins' ? SKINS : BACKGROUNDS;
            const owned = type === 'skins' ? playerData.ownedSkins : playerData.ownedBackgrounds;
            const selected = type === 'skins' ? playerData.selectedSkin : playerData.selectedBackground;

            shopContentEl.innerHTML = `
                <div class="shop-items">
                    ${items.map(item => {
                        const isOwned = owned.includes(item.id);
                        const isSelected = selected === item.id;
                        const canAfford = playerData.coins >= item.price;
                        
                        let statusClass = isSelected ? 'selected' : !isOwned && canAfford ? 'locked affordable' : !isOwned ? 'locked' : '';

                        return `
                            <div class="shop-item ${statusClass}" data-id="${item.id}" data-type="${type}">
                                <div class="item-preview ${item.class}">${type === 'skins' ? 'üêç' : 'üé®'}</div>
                                <div class="item-name">${item.name}</div>
                                ${isOwned 
                                    ? `<div class="item-owned">${isSelected ? '‚úì –í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å'}</div>`
                                    : `<div class="item-price">üí∞ ${item.price}</div>`
                                }
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            document.querySelectorAll(`.shop-item[data-type="${type}"]`).forEach(el => {
                el.addEventListener('click', () => handleItemClick(el.dataset.id, type));
            });
        }

        function handleItemClick(id, type) {
            const items = type === 'skins' ? SKINS : BACKGROUNDS;
            const item = items.find(i => i.id === id);
            const owned = type === 'skins' ? playerData.ownedSkins : playerData.ownedBackgrounds;

            if (owned.includes(id)) {
                if (type === 'skins') playerData.selectedSkin = id;
                else playerData.selectedBackground = id;
                savePlayerData();
                renderItems(type);
                updateCanvasStyle();
                vibrate(30);
            } else if (playerData.coins >= item.price) {
                playerData.coins -= item.price;
                owned.push(id);
                if (type === 'skins') playerData.selectedSkin = id;
                else playerData.selectedBackground = id;
                savePlayerData();
                coinsEl.textContent = playerData.coins;
                shopCoinsEl.textContent = playerData.coins;
                renderItems(type);
                updateCanvasStyle();
                vibrate(100);
            }
        }

        function updateCanvasStyle() {
            const bg = BACKGROUNDS.find(b => b.id === playerData.selectedBackground);
            canvas.style.borderColor = bg.border;
            canvas.style.boxShadow = `0 0 30px ${bg.border}40`;
        }

        // ===== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê =====
        function initGame() {
            const startX = Math.floor(tileCount / 2);
            const startY = Math.floor(tileCount / 2);
            
            snake = [
                { x: startX, y: startY },
                { x: startX - 1, y: startY },
                { x: startX - 2, y: startY }
            ];
            
            direction = { x: 1, y: 0 };
            nextDirection = { x: 1, y: 0 };
            score = 0;
            coinsThisGame = 0;
            applesThisGame = 0;
            scoreEl.textContent = score;
            originalSpeed = baseSpeed;
            gameSpeed = baseSpeed;
            
            if (slowMode) gameSpeed = baseSpeed * 3;
            if (fastMode) gameSpeed = Math.max(30, baseSpeed / 2);
            
            spawnFood();
            updateCanvasStyle();
            updateMultDisplay();
            updateUI();
        }

        function spawnFood() {
            do {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (snake.some(segment => segment.x === food.x && segment.y === food.y));
        }

        function update() {
            if (!isRunning || isPaused) return;

            direction = { ...nextDirection };

            const head = {
                x: snake[0].x + direction.x,
                y: snake[0].y + direction.y
            };

            if (!godMode) {
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                    gameOver();
                    return;
                }
                if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    gameOver();
                    return;
                }
            } else {
                if (head.x < 0) head.x = tileCount - 1;
                if (head.x >= tileCount) head.x = 0;
                if (head.y < 0) head.y = tileCount - 1;
                if (head.y >= tileCount) head.y = 0;
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score += 10;
                applesThisGame++;
                coinsThisGame += Math.floor(getTotalMultiplier()) + getFoodBonus();
                scoreEl.textContent = score;
                
                if (!slowMode && !fastMode && gameSpeed > 50) {
                    gameSpeed -= 1;
                    originalSpeed = gameSpeed;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(update, gameSpeed);
                }
                
                spawnFood();
                vibrate(50);
            } else {
                snake.pop();
            }

            draw();
        }

        function draw() {
            const bg = BACKGROUNDS.find(b => b.id === playerData.selectedBackground);
            const skin = SKINS.find(s => s.id === playerData.selectedSkin);
            const selectedFood = getSelectedFood();

            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, bg.colors[0]);
            gradient.addColorStop(1, bg.colors[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = 'rgba(255,255,255,0.03)';
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }

            // –ï–¥–∞
            const foodX = food.x * gridSize + gridSize / 2;
            const foodY = food.y * gridSize + gridSize / 2;
            
            ctx.shadowColor = selectedFood.color;
            ctx.shadowBlur = 10;
            
            ctx.beginPath();
            ctx.arc(foodX, foodY, gridSize / 2 - 2, 0, Math.PI * 2);
            ctx.fillStyle = selectedFood.color;
            ctx.fill();
            
            ctx.shadowBlur = 0;
            
            ctx.font = `${gridSize - 4}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(selectedFood.emoji, foodX, foodY + 1);

            // –ó–º–µ–π–∫–∞
            snake.forEach((segment, index) => {
                const x = segment.x * gridSize;
                const y = segment.y * gridSize;
                
                let color;
                if (skin.colors[0] === 'rainbow') {
                    const hue = (index * 30 + Date.now() / 20) % 360;
                    color = `hsl(${hue}, 100%, 50%)`;
                } else {
                    const t = index / Math.max(snake.length - 1, 1);
                    color = lerpColor(skin.colors[0], skin.colors[1], t);
                }
                
                if (godMode && index === 0) {
                    ctx.shadowColor = '#ff0000';
                    ctx.shadowBlur = 15;
                }
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.roundRect(x + 1, y + 1, gridSize - 2, gridSize - 2, index === 0 ? 6 : 4);
                ctx.fill();
                
                ctx.shadowBlur = 0;

                if (index === 0) {
                    ctx.fillStyle = godMode ? '#ff0000' : '#1a1a2e';
                    const eyePositions = getEyePositions(x, y, direction);
                    eyePositions.forEach(pos => {
                        ctx.beginPath();
                        ctx.arc(pos.x, pos.y, 3, 0, Math.PI * 2);
                        ctx.fill();
                    });
                }
            });
        }

        function getEyePositions(x, y, dir) {
            if (dir.x === 1) return [{ x: x + gridSize - 6, y: y + 6 }, { x: x + gridSize - 6, y: y + gridSize - 6 }];
            if (dir.x === -1) return [{ x: x + 6, y: y + 6 }, { x: x + 6, y: y + gridSize - 6 }];
            if (dir.y === 1) return [{ x: x + 6, y: y + gridSize - 6 }, { x: x + gridSize - 6, y: y + gridSize - 6 }];
            return [{ x: x + 6, y: y + 6 }, { x: x + gridSize - 6, y: y + 6 }];
        }

        function lerpColor(color1, color2, t) {
            const c1 = hexToRgb(color1), c2 = hexToRgb(color2);
            return `rgb(${Math.round(c1.r + (c2.r - c1.r) * t)}, ${Math.round(c1.g + (c2.g - c1.g) * t)}, ${Math.round(c1.b + (c2.b - c1.b) * t)})`;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : { r: 0, g: 0, b: 0 };
        }

        function gameOver() {
            isRunning = false;
            clearInterval(gameLoop);
            updatePauseButton();
            
            playerData.coins += coinsThisGame;
            coinsEl.textContent = playerData.coins;
            
            const isNewRecord = score > playerData.highScore;
            if (isNewRecord) {
                playerData.highScore = score;
                highScoreEl.textContent = playerData.highScore;
            }
            
            savePlayerData();
            
            finalScoreEl.textContent = score;
            coinsEarnedEl.textContent = coinsThisGame;
            multBreakdownEl.textContent = `${applesThisGame} √ó (${getTotalMultiplier()} + ${getFoodBonus()})`;
            newRecordEl.style.display = isNewRecord ? 'block' : 'none';
            
            difficultyBadgeEl.className = 'difficulty-badge ' + selectedSpeedClass;
            difficultyBadgeEl.textContent = selectedDifficulty;
            
            gameOverEl.classList.remove('hidden');
            vibrate([100, 50, 100]);
        }

        function startGame() {
            startScreenEl.classList.add('hidden');
            gameOverEl.classList.add('hidden');
            pauseOverlayEl.classList.add('hidden');
            shopModal.classList.add('hidden');
            adminModal.classList.add('hidden');
            confirmModal.classList.add('hidden');
            initGame();
            draw();
            isRunning = true;
            isPaused = false;
            updatePauseButton();
            gameLoop = setInterval(update, gameSpeed);
        }

        function togglePause() {
            if (!isRunning) return;
            isPaused = !isPaused;
            
            if (isPaused) {
                document.getElementById('pauseScore').textContent = score;
                document.getElementById('pauseCoins').textContent = coinsThisGame;
            }
            
            pauseOverlayEl.classList.toggle('hidden', !isPaused);
            updatePauseButton();
        }

        function updatePauseButton() {
            pauseBtnEl.textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            pauseBtnEl.classList.toggle('paused', isPaused);
        }

        function vibrate(pattern) {
            if (navigator.vibrate) navigator.vibrate(pattern);
        }

        function changeDirection(newDir) {
            if (!isRunning || isPaused) return;
            
            const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
            const currentDir = direction.x === 1 ? 'right' : direction.x === -1 ? 'left' : direction.y === 1 ? 'down' : 'up';
            
            if (opposites[newDir] === currentDir && !godMode) return;
            
            const dirs = { up: { x: 0, y: -1 }, down: { x: 0, y: 1 }, left: { x: -1, y: 0 }, right: { x: 1, y: 0 } };
            nextDirection = dirs[newDir];
            vibrate(10);
        }

        // ===== –°–û–ë–´–¢–ò–Ø =====
        speedBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                speedBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                baseSpeed = parseInt(btn.dataset.speed);
                selectedDifficulty = btn.dataset.name;
                difficultyMult = parseInt(btn.dataset.mult);
                selectedSpeedClass = btn.classList[1];
                updateMultDisplay();
            });
        });

        shopTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                shopTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentShopTab = tab.dataset.tab;
                renderShopContent();
            });
        });

        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('resumeBtn').addEventListener('click', togglePause);
        document.getElementById('shopBtn').addEventListener('click', openShop);
        document.getElementById('closeShop').addEventListener('click', closeShop);
        document.getElementById('closeShopBtn').addEventListener('click', closeShop);
        
        // –ö–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞ –≤ –º–µ–Ω—é
        document.getElementById('homeBtn').addEventListener('click', showExitConfirm);
        document.getElementById('menuFromPause').addEventListener('click', showExitConfirm);
        document.getElementById('menuFromGameOver').addEventListener('click', goToMenu);
        document.getElementById('confirmExit').addEventListener('click', goToMenu);
        document.getElementById('cancelExit').addEventListener('click', cancelExit);

        let touchStartX = 0, touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            if (e.target.closest('.modal')) return;
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchend', (e) => {
            if (e.target.closest('.modal') || e.target.closest('.header')) return;
            const deltaX = e.changedTouches[0].clientX - touchStartX;
            const deltaY = e.changedTouches[0].clientY - touchStartY;
            
            if (Math.abs(deltaX) < 30 && Math.abs(deltaY) < 30) return;

            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                changeDirection(deltaX > 0 ? 'right' : 'left');
            } else {
                changeDirection(deltaY > 0 ? 'down' : 'up');
            }
        }, { passive: true });

        document.addEventListener('keydown', (e) => {
            const keyMap = { 'ArrowUp': 'up', 'w': 'up', 'ArrowDown': 'down', 's': 'down', 'ArrowLeft': 'left', 'a': 'left', 'ArrowRight': 'right', 'd': 'right' };
            if (keyMap[e.key]) changeDirection(keyMap[e.key]);
            if (e.key === ' ' || e.key === 'Escape') {
                if (confirmModal.classList.contains('hidden')) {
                    togglePause();
                } else {
                    cancelExit();
                }
            }
            if (e.key === 'Enter' && !isRunning) startGame();
            if (e.key === '`' || e.key === '~') openAdmin();
            if (e.key === 'Home' || e.key === 'h') showExitConfirm();
        });

        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            };
        }

        initGame();
        updateCanvasStyle();
        draw();
    </script>
</body>
</html>
