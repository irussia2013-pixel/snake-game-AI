<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Snake: Pause Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
            touch-action: none;
        }

        #scorePanel {
            display: flex;
            justify-content: space-between;
            width: 360px;
            font-size: 20px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .record-val { color: #f1c40f; }

        #gameContainer {
            position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
            border-radius: 15px;
        }

        canvas {
            display: block;
            background-color: #0f0f1a;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 15px;
        }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 15, 26, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .btn-group { display: flex; flex-direction: column; gap: 12px; width: 220px; }

        button {
            padding: 15px;
            font-size: 18px;
            font-family: 'Fredoka One', cursive;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }
        .btn-easy { background: #2ecc71; box-shadow: 0 0 15px #2ecc71; }
        .btn-medium { background: #f1c40f; box-shadow: 0 0 15px #f1c40f; }
        .btn-hard { background: #e74c3c; box-shadow: 0 0 15px #e74c3c; }
        .btn-restart { background: #3498db; box-shadow: 0 0 15px #3498db; }
        .btn-resume { background: #9b59b6; box-shadow: 0 0 15px #9b59b6; }

        #pauseBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            padding: 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            z-index: 5;
            font-size: 14px;
        }

        .hidden { display: none !important; }
        .new-record { animation: glow 0.5s infinite alternate; }

        @keyframes glow {
            from { text-shadow: 0 0 5px #fff, 0 0 10px #f1c40f; }
            to { text-shadow: 0 0 10px #fff, 0 0 20px #f1c40f; }
        }
    </style>
</head>
<body>

    <div id="scorePanel">
        <div>Счёт: <span id="scoreVal">0</span></div>
        <div>Рекорд: <span id="highScoreVal" class="record-val">0</span></div>
    </div>

    <div id="gameContainer">
        <button id="pauseBtn" onclick="togglePause()">II</button>
        <canvas id="gameCanvas" width="360" height="360" onclick="togglePause()"></canvas>
        
        <div id="menuOverlay" class="overlay">
            <h2 style="margin-bottom:10px">NEON SNAKE</h2>
            <div class="btn-group">
                <button class="btn-easy" onclick="startGame('easy', 180)">ЛЕГКО</button>
                <button class="btn-medium" onclick="startGame('medium', 110)">НОРМАЛЬНО</button>
                <button class="btn-hard" onclick="startGame('hard', 70)">СЛОЖНО</button>
            </div>
        </div>

        <div id="pauseOverlay" class="overlay hidden">
            <h2 style="color: #9b59b6;">ПАУЗА</h2>
            <div class="btn-group">
                <button class="btn-resume" onclick="togglePause()">ПРОДОЛЖИТЬ</button>
                <button class="btn-restart" onclick="showMenu()">В МЕНЮ</button>
            </div>
        </div>

        <div id="gameOverOverlay" class="overlay hidden">
            <h2 id="overTitle" style="color: #e74c3c;">GAME OVER</h2>
            <p style="font-size: 20px;">Счёт: <span id="finalScore">0</span></p>
            <p id="recordMsg" style="color: #f1c40f; display:none; margin-bottom: 20px;">НОВЫЙ РЕКОРД!</p>
            <div class="btn-group">
                <button class="btn-restart" onclick="showMenu()">В МЕНЮ</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreValElement = document.getElementById("scoreVal");
        const highScoreValElement = document.getElementById("highScoreVal");
        const finalScoreElement = document.getElementById("finalScore");
        const menuOverlay = document.getElementById("menuOverlay");
        const pauseOverlay = document.getElementById("pauseOverlay");
        const gameOverOverlay = document.getElementById("gameOverOverlay");

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let score = 0, dx = 0, dy = 0, snake = [];
        let food = {x: 5, y: 5};
        let gameRunning = false, isPaused = false;
        let gameSpeed = 110, currentDifficulty = 'medium', gameLoop;

        function getHighScore(diff) { return localStorage.getItem('snake_hc_' + diff) || 0; }

        function startGame(diff, speed) {
            currentDifficulty = diff;
            gameSpeed = speed;
            highScoreValElement.innerText = getHighScore(diff);
            menuOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            resetGameState();
            gameRunning = true;
            isPaused = false;
            main();
        }

        function togglePause() {
            if (!gameRunning) return;
            isPaused = !isPaused;
            if (isPaused) {
                pauseOverlay.classList.remove('hidden');
                clearTimeout(gameLoop);
            } else {
                pauseOverlay.classList.add('hidden');
                main();
            }
        }

        function showMenu() {
            gameOverOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            menuOverlay.classList.remove('hidden');
            gameRunning = false;
            isPaused = false;
            clearTimeout(gameLoop);
        }

        function resetGameState() {
            score = 0;
            scoreValElement.innerHTML = "0";
            scoreValElement.classList.remove('new-record');
            snake = [{x: 9, y: 9}, {x: 8, y: 9}, {x: 7, y: 9}];
            dx = 1; dy = 0;
            createFood();
        }

        function main() {
            if (isPaused || !gameRunning) return;

            if (didGameEnd()) {
                showGameOver();
                return;
            }

            gameLoop = setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawFood();
                advanceSnake();
                drawSnake();
                main();
            }, gameSpeed);
        }

        function drawSnake() {
            snake.forEach((part, index) => {
                ctx.shadowBlur = 15;
                ctx.fillStyle = (index === 0) ? "#00ffcc" : "#2ecc71";
                ctx.shadowColor = ctx.fillStyle;
                ctx.beginPath();
                ctx.roundRect(part.x * gridSize + 1, part.y * gridSize + 1, gridSize - 2, gridSize - 2, 6);
                ctx.fill();
            });
            ctx.shadowBlur = 0;
        }

        function advanceSnake() {
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreValElement.innerHTML = score;
                if (score > getHighScore(currentDifficulty)) scoreValElement.classList.add('new-record');
                createFood();
            } else {
                snake.pop();
            }
        }

        function didGameEnd() {
            const head = snake[0];
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) return true;
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) return true;
            }
            return false;
        }

        function createFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);
            if (snake.some(p => p.x === food.x && p.y === food.y)) createFood();
        }

        function drawFood() {
            ctx.shadowBlur = 20; ctx.shadowColor = "#e74c3c"; ctx.fillStyle = "#ff5e57";
            ctx.beginPath();
            ctx.arc(food.x * gridSize + 10, food.y * gridSize + 10, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        let tsX = 0, tsY = 0;
        window.addEventListener('touchstart', e => { tsX = e.touches[0].clientX; tsY = e.touches[0].clientY; }, {passive: false});
        window.addEventListener('touchend', e => {
            if (!gameRunning || isPaused) return;
            const dx_swipe = e.changedTouches[0].clientX - tsX;
            const dy_swipe = e.changedTouches[0].clientY - tsY;
            if (Math.abs(dx_swipe) > Math.abs(dy_swipe)) {
                if (Math.abs(dx_swipe) > 30) { 
                    if (dx_swipe > 0 && dx === 0) { dx = 1; dy = 0; } 
                    else if (dx_swipe < 0 && dx === 0) { dx = -1; dy = 0; } 
                }
            } else {
                if (Math.abs(dy_swipe) > 30) { 
                    if (dy_swipe > 0 && dy === 0) { dx = 0; dy = 1; } 
                    else if (dy_swipe < 0 && dy === 0) { dx = 0; dy = -1; } 
                }
            }
        });

        function showGameOver() {
            gameRunning = false;
            const hc = getHighScore(currentDifficulty);
            if (score > hc) {
                localStorage.setItem('snake_hc_' + currentDifficulty, score);
                document.getElementById('recordMsg').style.display = 'block';
            } else {
                document.getElementById('recordMsg').style.display = 'none';
            }
            finalScoreElement.innerText = score;
            gameOverOverlay.classList.remove('hidden');
        }
    </script>
</body>
</html>
